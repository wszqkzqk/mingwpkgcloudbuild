 
# Maintainer: Alexey Pavlov <alexpux@gmail.com>

_realname=cambalache
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=0.10.3
pkgrel=1
pkgdesc="A new RAD tool for Gtk 4 and 3 with a clear MVC design and data model first philosophy (mingw-w64)"
arch=('any')
mingw_arch=('mingw32' 'mingw64' 'ucrt64' 'clang64' 'clang32')
url="https://gitlab.gnome.org/jpu/cambalache"
license=("LGPL2.1")
options=('strip' '!debug' 'staticlibs')
depends=("${MINGW_PACKAGE_PREFIX}-gtk3"
         "${MINGW_PACKAGE_PREFIX}-gtk4"
         #"${MINGW_PACKAGE_PREFIX}-webkit2gtk"
         "${MINGW_PACKAGE_PREFIX}-glib2"
         "${MINGW_PACKAGE_PREFIX}-python-lxml"
         "${MINGW_PACKAGE_PREFIX}-python-gobject"
         "${MINGW_PACKAGE_PREFIX}-libadwaita"
         "${MINGW_PACKAGE_PREFIX}-libhandy"
         "${MINGW_PACKAGE_PREFIX}-gobject-introspection")
makedepends=("${MINGW_PACKAGE_PREFIX}-meson"
             "${MINGW_PACKAGE_PREFIX}-ninja")
source=("$url/-/archive/$pkgver/$pkgname-$pkgver.tar.gz")
sha512sums=('1ae55ec26df44a7b219f1900133b2b7b132deae684d0a65c805253c353ed6b9e28dd6b8d6cc9737bff165600da3b823e38980547c059fc3fe547fe2eeede0cc2')

prepare() {
  cd "${srcdir}/${_realname}-${pkgver}-2dd3ada526323671537ea882038b76f175fa7371"
}

build() {
  [[ -d ${srcdir}/build-${MINGW_CHOST} ]] && rm -rf ${srcdir}/build-${MINGW_CHOST}
  mkdir -p ${srcdir}/build-${MINGW_CHOST} && cd ${srcdir}/build-${MINGW_CHOST}

  MSYS2_ARG_CONV_EXCL="--prefix=" \
  meson \
      --prefix="${MINGW_PREFIX}" \
      --buildtype plain \
      --auto-features=enabled \
       -Dgtk_doc=false \
       -Dgjs=disabled \
       -Dwebkit2gtk=disabled \
       #-Dgladeui=true \
       -Dintrospection=true \
      ../${_realname}-${pkgver}-2dd3ada526323671537ea882038b76f175fa7371

  ninja
}

package() {
  cd "${srcdir}/build-${MINGW_CHOST}"
  meson install -C build --destdir "${pkgdir}"
}
